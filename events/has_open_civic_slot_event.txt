########################
# civic_slot_calculate #
########################

namespace = civic_slot_calculate

# Calling calculation for the first time
country_event = {
    id = civic_slot_calculate.1
    fire_only_once = yes
    is_triggered_only = no
    hide_window = yes
    immediate = {
        add_modifier = { modifier = not_open_to_government days = 0 }
    }
}

# Applies open_to_government or not_open_to_government static modifiers
country_event = {
    id = civic_slot_calculate.2
    
    is_triggered_only = yes
    hide_window = yes

    immediate = {
        # Getting players civic count
        set_variable = { which = total_civics value = 0 }
        
        if = { limit = { has_civic = civic_agrarian_idyll } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_aristocratic_elite } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_barbaric_despoilers } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_beacon_of_liberty } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_byzantine_bureaucracy } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_citizen_service } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_corporate_dominion } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_corvee_system } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_cutthroat_politics } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_death_cult } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_diplomatic_corps } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_distinguished_admiralty } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_efficient_bureaucracy } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_environmentalist } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_exalted_priesthood } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_fanatic_purifiers } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_feudal_realm } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_free_haven } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_functional_architecture } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_idealistic_foundation } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_imperial_cult } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_inwards_perfection } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_memorialist } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_merchant_guilds } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_meritocracy } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_mining_guilds } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_nationalistic_zeal } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_parliamentary_system } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_philosopher_king } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_police_state } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_reanimated_armies } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_shadow_council } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_shared_burden } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_slaver_guilds } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_technocracy } change_variable = { which = total_civics value = 1 } }
        if = { limit = { has_civic = civic_warrior_culture } change_variable = { which = total_civics value = 1 } }

        # Getting players civic max
        set_variable = {
            which = civic_max
            value = 2
        }
        if = {
            limit = {
                has_technology = tech_galactic_administration
            }
            change_variable = { which = civic_max value = 1 }
        }
        if = {
            limit = { 
                OR = {
                    has_civic = civic_galactic_sovereign
                    has_civic = civic_galactic_sovereign_megacorp
                }
            }
            change_variable = { which = civic_max value = 1 }
        }

        # Determine if you have open slots
        set_variable = {
            which = civic_slots_open
            value = civic_max
        }
        subtract_variable = {
            which = civic_slots_open
            value = total_civics
        }

        # Apply static modifiers
        if = {
            limit = {
                check_variable = {
                    which = total_civics
                    value > 0
                }
            }
            add_modifier = { modifier = open_to_government days = 0 }
            remove_modifier = not_open_to_government

        }
        if = {
            limit = {
                check_variable = {
                    which = total_civics
                    value = 0
                }
            }
            add_modifier = { modifier = not_open_to_government days = 0 }
            remove_modifier = open_to_government
        }        
    }
}
