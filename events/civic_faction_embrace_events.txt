########################
# Civic faction events #
########################

namespace = faction_embrace

# Applies has civic slots or no civic slots country flags
pop_faction_event = {
    id = faction_embrace.1
    
    is_triggered_only = yes
    hide_window = yes

    immediate = {
        owner = {
            # Getting players civic count
            set_variable = { which = total_chosen_civics value = 0 }
            
            if = { limit = { has_civic = civic_agrarian_idyll } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_aristocratic_elite } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_barbaric_despoilers } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_beacon_of_liberty } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_byzantine_bureaucracy } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_citizen_service } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_corporate_dominion } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_corvee_system } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_cutthroat_politics } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_death_cult } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_diplomatic_corps } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_distinguished_admiralty } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_efficient_bureaucracy } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_environmentalist } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_exalted_priesthood } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_fanatic_purifiers } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_feudal_realm } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_free_haven } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_functional_architecture } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_idealistic_foundation } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_imperial_cult } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_inwards_perfection } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_memorialist } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_merchant_guilds } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_meritocracy } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_mining_guilds } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_nationalistic_zeal } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_parliamentary_system } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_philosopher_king } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_police_state } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_reanimated_armies } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_shadow_council } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_shared_burden } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_slaver_guilds } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_technocracy } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_warrior_culture } change_variable = { which = total_chosen_civics value = 1 } }

            # Add galatic sovereign
            if = { limit = { has_civic = civic_galactic_sovereign } change_variable = { which = total_chosen_civics value = 1 } }
            if = { limit = { has_civic = civic_galactic_sovereign_megacorp } change_variable = { which = total_chosen_civics value = 1 } }

            # Getting players civic max
            set_variable = {
                which = civic_point_limit
                value = 2
            }
            if = {
                limit = {
                    has_technology = tech_galactic_administration
                }
                change_variable = { which = civic_point_limit value = 1 }
            }
            if = {
                limit = { 
                    OR = {
                        has_civic = civic_galactic_sovereign
                        has_civic = civic_galactic_sovereign_megacorp
                    }
                }
                change_variable = { which = civic_point_limit value = 1 }
            }

            # Determine if you have open slots
            subtract_variable = {
                which = civic_point_limit
                value = total_chosen_civics
            }

            # Apply static modifiers
            if = {
                limit = {
                    check_variable = {
                        which = total_chosen_civics
                        value > 0
                    }
                }
                set_country_flag = has_civic_slots
                remove_country_flag = no_civic_slots
            }
            if = {
                limit = {
                    check_variable = {
                        which = total_chosen_civics
                        value = 0
                    }
                }
                set_country_flag = no_civic_slots
                remove_country_flag = has_civic_slots
            }        
        }

        # Now that civic count is updated, call the actual event
        pop_faction_event = {
            id = faction_embrace.2
        }
    }
}

pop_faction_event = {
    id = faction_embrace.2
    title = faction_embrace.2.name
    desc = {
        trigger = {
            text = faction_embrace.2.desc.start

            text = newline

            # Civic faction middle desc
            success_text = { text = faction_embrace.2.desc.agrarian_idyll is_pop_faction_type = agrarian_idyll }
            success_text = { text = faction_embrace.2.desc.aristocratic_elite is_pop_faction_type = aristocratic_elite }
            success_text = { text = faction_embrace.2.desc.barbaric_despoilers is_pop_faction_type = barbaric_despoilers }
            success_text = { text = faction_embrace.2.desc.beacon_of_liberty is_pop_faction_type = beacon_of_liberty }
            success_text = { text = faction_embrace.2.desc.byzantine_bureaucracy is_pop_faction_type = byzantine_bureaucracy }
            success_text = { text = faction_embrace.2.desc.citizen_service is_pop_faction_type = citizen_service }
            success_text = { text = faction_embrace.2.desc.corporate_dominion is_pop_faction_type = corporate_dominion }
            success_text = { text = faction_embrace.2.desc.corvee_system is_pop_faction_type = corvee_system }
            success_text = { text = faction_embrace.2.desc.cutthroat_politics is_pop_faction_type = cutthroat_politics }
            success_text = { text = faction_embrace.2.desc.death_cult is_pop_faction_type = death_cult }
            success_text = { text = faction_embrace.2.desc.diplomatic_corps is_pop_faction_type = diplomatic_corps }
            success_text = { text = faction_embrace.2.desc.distinguished_admiralty is_pop_faction_type = distinguished_admiralty }
            success_text = { text = faction_embrace.2.desc.efficient_bureaucracy is_pop_faction_type = efficient_bureaucracy }
            success_text = { text = faction_embrace.2.desc.environmentalist is_pop_faction_type = environmentalist }
            success_text = { text = faction_embrace.2.desc.exalted_priesthood is_pop_faction_type = exalted_priesthood }
            success_text = { text = faction_embrace.2.desc.fanatic_purifiers is_pop_faction_type = fanatic_purifiers }
            success_text = { text = faction_embrace.2.desc.feudal_realm is_pop_faction_type = feudal_realm }
            success_text = { text = faction_embrace.2.desc.free_haven is_pop_faction_type = free_haven }
            success_text = { text = faction_embrace.2.desc.functional_architecture is_pop_faction_type = functional_architecture }
            success_text = { text = faction_embrace.2.desc.idealistic_foundation is_pop_faction_type = idealistic_foundation }
            success_text = { text = faction_embrace.2.desc.imperial_cult is_pop_faction_type = imperial_cult }
            success_text = { text = faction_embrace.2.desc.inwards_perfection is_pop_faction_type = inwards_perfection }
            success_text = { text = faction_embrace.2.desc.memorialist is_pop_faction_type = memorialist }
            success_text = { text = faction_embrace.2.desc.merchant_guilds is_pop_faction_type = merchant_guilds }
            success_text = { text = faction_embrace.2.desc.meritocracy is_pop_faction_type = meritocracy }
            success_text = { text = faction_embrace.2.desc.mining_guilds is_pop_faction_type = mining_guilds }
            success_text = { text = faction_embrace.2.desc.nationalistic_zeal is_pop_faction_type = nationalistic_zeal }
            success_text = { text = faction_embrace.2.desc.parliamentary_system is_pop_faction_type = parliamentary_system }
            success_text = { text = faction_embrace.2.desc.philosopher_king is_pop_faction_type = philosopher_king }
            success_text = { text = faction_embrace.2.desc.police_state is_pop_faction_type = police_state }
            success_text = { text = faction_embrace.2.desc.reanimated_armies is_pop_faction_type = reanimated_armies }
            success_text = { text = faction_embrace.2.desc.shadow_council is_pop_faction_type = shadow_council }
            success_text = { text = faction_embrace.2.desc.shared_burden is_pop_faction_type = shared_burden }
            success_text = { text = faction_embrace.2.desc.slaver_guilds is_pop_faction_type = slaver_guilds }
            success_text = { text = faction_embrace.2.desc.technocracy is_pop_faction_type = technocracy }
            success_text = { text = faction_embrace.2.desc.warrior_culture is_pop_faction_type = warrior_culture }

            text = newline

            # If we don't have space we need to explain what is going on
            success_text = {      
                text = faction_embrace.2.desc.no_open_civic_slot
                owner = {
                    has_country_flag = no_civic_slots  
                }
            }
        }
    }
    
    picture = GFX_evt_galactic_senate
    show_sound = event_factions
    is_triggered_only = yes

    # Adopt the civic without removing one
    option = {
        name = faction_embrace.2.adoptWithoutAbandon
        trigger = {
            owner = { 
                has_country_flag = has_civic_slots  
            }
        }
    }

    # Choose a civic to remove
    option = {
        name = faction_embrace.2.abandon_byzantine_bureaucracy
        trigger = {
            owner = { 
                has_country_flag = no_civic_slots
                has_civic = civic_byzantine_bureaucracy
            }
        }
        hidden_effect = {
            owner = {
                force_remove_civic = civic_byzantine_bureaucracy
            }
            if = { limit = { is_pop_faction_type = agrarian_idyll } owner = { force_add_civic = civic_agrarian_idyll } }
            else_if = { limit = { is_pop_faction_type = aristocratic_elite } owner = { force_add_civic = civic_aristocratic_elite } }
            else_if = { limit = { is_pop_faction_type = barbaric_despoilers } owner = { force_add_civic = civic_barbaric_despoilers } }
            else_if = { limit = { is_pop_faction_type = beacon_of_liberty } owner = { force_add_civic = civic_beacon_of_liberty } }
            else_if = { limit = { is_pop_faction_type = byzantine_bureaucracy } owner = { force_add_civic = civic_byzantine_bureaucracy } }
            else_if = { limit = { is_pop_faction_type = citizen_service } owner = { force_add_civic = civic_citizen_service } }
            else_if = { limit = { is_pop_faction_type = corporate_dominion } owner = { force_add_civic = civic_corporate_dominion } }
            else_if = { limit = { is_pop_faction_type = corvee_system } owner = { force_add_civic = civic_corvee_system } }
            else_if = { limit = { is_pop_faction_type = cutthroat_politics } owner = { force_add_civic = civic_cutthroat_politics } }
            else_if = { limit = { is_pop_faction_type = death_cult } owner = { force_add_civic = civic_death_cult } }
            else_if = { limit = { is_pop_faction_type = diplomatic_corps } owner = { force_add_civic = civic_diplomatic_corps } }
            else_if = { limit = { is_pop_faction_type = distinguished_admiralty } owner = { force_add_civic = civic_distinguished_admiralty } }
            else_if = { limit = { is_pop_faction_type = efficient_bureaucracy } owner = { force_add_civic = civic_efficient_bureaucracy } }
            else_if = { limit = { is_pop_faction_type = environmentalist } owner = { force_add_civic = civic_environmentalist } }
            else_if = { limit = { is_pop_faction_type = exalted_priesthood } owner = { force_add_civic = civic_exalted_priesthood } }
            else_if = { limit = { is_pop_faction_type = fanatic_purifiers } owner = { force_add_civic = civic_fanatic_purifiers } }
            else_if = { limit = { is_pop_faction_type = feudal_realm } owner = { force_add_civic = civic_feudal_realm } }
            else_if = { limit = { is_pop_faction_type = free_haven } owner = { force_add_civic = civic_free_haven } }
            else_if = { limit = { is_pop_faction_type = functional_architecture } owner = { force_add_civic = civic_functional_architecture } }
            else_if = { limit = { is_pop_faction_type = idealistic_foundation } owner = { force_add_civic = civic_idealistic_foundation } }
            else_if = { limit = { is_pop_faction_type = imperial_cult } owner = { force_add_civic = civic_imperial_cult } }
            else_if = { limit = { is_pop_faction_type = inwards_perfection } owner = { force_add_civic = civic_inwards_perfection } }
            else_if = { limit = { is_pop_faction_type = memorialist } owner = { force_add_civic = civic_memorialist } }
            else_if = { limit = { is_pop_faction_type = merchant_guilds } owner = { force_add_civic = civic_merchant_guilds } }
            else_if = { limit = { is_pop_faction_type = meritocracy } owner = { force_add_civic = civic_meritocracy } }
            else_if = { limit = { is_pop_faction_type = mining_guilds } owner = { force_add_civic = civic_mining_guilds } }
            else_if = { limit = { is_pop_faction_type = nationalistic_zeal } owner = { force_add_civic = civic_nationalistic_zeal } }
            else_if = { limit = { is_pop_faction_type = parliamentary_system } owner = { force_add_civic = civic_parliamentary_system } }
            else_if = { limit = { is_pop_faction_type = philosopher_king } owner = { force_add_civic = civic_philosopher_king } }
            else_if = { limit = { is_pop_faction_type = police_state } owner = { force_add_civic = civic_police_state } }
            else_if = { limit = { is_pop_faction_type = reanimated_armies } owner = { force_add_civic = civic_reanimated_armies } }
            else_if = { limit = { is_pop_faction_type = shadow_council } owner = { force_add_civic = civic_shadow_council } }
            else_if = { limit = { is_pop_faction_type = shared_burden } owner = { force_add_civic = civic_shared_burden } }
            else_if = { limit = { is_pop_faction_type = slaver_guilds } owner = { force_add_civic = civic_slaver_guilds } }
            else_if = { limit = { is_pop_faction_type = technocracy } owner = { force_add_civic = civic_technocracy } }
            else_if = { limit = { is_pop_faction_type = warrior_culture } owner = { force_add_civic = civic_warrior_culture } }
        }
    }

    # Cancel civic adoption
    option = {
        name = faction_embrace.2.cancel
    }
}
